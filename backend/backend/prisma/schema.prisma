generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Staff {
  id               Int              @id @default(autoincrement())
  nome             String
  ruolo            String
  email            String?          @unique
  createdAt        DateTime         @default(now())
  cognome          String           @default("")
  costoOra         Float            @default(0)
  oreMassime       Int              @default(40)
  oreMinime        Int              @default(0)
  postazioni       String[]
  listIndex        Int              @default(999)
  fixedShifts      Json?
  assignments      Assignment[]
  recurringShifts  RecurringShift[]
  unavailabilities Unavailability[]
}

model ShiftTemplate {
  id              Int              @id @default(autoincrement())
  nome            String
  oraInizio       String
  oraFine         String
  ruoloRichiesto  String
  giorniValidi    Int[]
  assignments     Assignment[]
  recurringShifts RecurringShift[]
}

model Unavailability {
  id         Int     @id @default(autoincrement())
  staffId    Int
  data       String
  tipo       String
  reason     String?
  start_time String?
  end_time   String?
  staff      Staff   @relation(fields: [staffId], references: [id], onDelete: Cascade)
}

model Constraint {
  id     Int    @id @default(autoincrement())
  tipo   String
  valore String
}

model Assignment {
  id              Int            @id @default(autoincrement())
  data            String
  staffId         Int
  shiftTemplateId Int?
  stato           String         @default("BOZZA")
  postazione      String?
  customEnd       String?
  customStart     String?
  start_time      String?
  end_time        String?
  status          Boolean?       @default(false)
  shiftTemplate   ShiftTemplate? @relation(fields: [shiftTemplateId], references: [id])
  staff           Staff          @relation(fields: [staffId], references: [id], onDelete: Cascade)
}

model Budget {
  id          Int       @id @default(autoincrement())
  data        String    @unique
  valueDinner Float     @default(0)
  valueLunch  Float     @default(0)
  hoursDinner Float     @default(0)
  hoursLunch  Float     @default(0)
  value       Float     @default(0)
  owner_id    String?   @db.Uuid
  created_by  String?   @db.Uuid
  created_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@index([data])
  @@index([owner_id], map: "idx_budget_owner_id")
}

model CoverageRow {
  id        Int    @id @default(autoincrement())
  weekStart String
  station   String
  frequency String
  slots     Json
  extra     Json
}

model ForecastRow {
  id        Int       @id @default(autoincrement())
  weekStart String
  data      String
  createdAt DateTime? @default(now()) @db.Timestamp(6)

  @@index([weekStart])
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  name     String?
  role     String  @default("USER")
  surname  String?
  dob      String?
  address  String?
}

model RecurringShift {
  id              Int            @id @default(autoincrement())
  staffId         Int
  dayOfWeek       Int
  start_time      String?
  end_time        String?
  shiftTemplateId Int?
  postazione      String?
  shiftTemplate   ShiftTemplate? @relation(fields: [shiftTemplateId], references: [id], onUpdate: NoAction)
  staff           Staff          @relation(fields: [staffId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}
